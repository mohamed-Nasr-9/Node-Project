import{a as g}from"./chunk-OHDIIJHJ.js";import{a as h,r as p}from"./chunk-VRDYXINS.js";import{B as n,E as i,Eb as s,Gb as c,Lb as u,Pb as m,j as o}from"./chunk-DBZ4JVQV.js";var d=class a{constructor(t,e,r,v,b){this.http=t;this.authService=e;this.cartService=r;this.snackBar=v;this.router=b}API_URL=m.apiUrl+"/books";getAllBooks(t={}){let e=new s;return t.page&&(e=e.set("page",t.page.toString())),t.limit&&(e=e.set("limit",t.limit.toString())),t.sort&&(e=e.set("sort",t.sort)),t.q&&(e=e.set("q",t.q)),t.author&&(e=e.set("author",t.author)),t.category&&(e=e.set("category",t.category)),t.minPrice!==void 0&&t.minPrice!==null&&(e=e.set("minPrice",t.minPrice.toString()),console.log("Service: Adding minPrice param:",t.minPrice)),t.maxPrice!==void 0&&t.maxPrice!==null&&(e=e.set("maxPrice",t.maxPrice.toString()),console.log("Service: Adding maxPrice param:",t.maxPrice)),t.isActive!==void 0&&(e=e.set("isActive",t.isActive.toString())),console.log("Service: Final URL params:",e.toString()),this.http.get(this.API_URL,{params:e})}getBestSellingBooks(){return this.http.get(`${this.API_URL}/best-selling`)}getBookById(t){return this.http.get(`${this.API_URL}/${t}`)}createBook(t){let e=this.authService.getAuthHeaders();return this.authService.isAuthenticated()?this.http.post(this.API_URL,t,{headers:e}):o(()=>({error:{message:"Authentication required"}}))}updateBook(t,e){let r=this.authService.getAuthHeaders();return this.authService.isAuthenticated()?this.http.put(`${this.API_URL}/${t}`,e,{headers:r}):o(()=>({error:{message:"Authentication required"}}))}deleteBook(t){let e=this.authService.getAuthHeaders();return this.authService.isAuthenticated()?this.http.delete(`${this.API_URL}/${t}`,{headers:e}):o(()=>({error:{message:"Authentication required"}}))}addToCart(t){if(!this.authService.isAuthenticated()){this.snackBar.open("Please login to add items to cart","Login",{duration:4e3,horizontalPosition:"center",verticalPosition:"top"}).onAction().subscribe(()=>{this.router.navigate(["/login"])}),setTimeout(()=>{this.authService.isAuthenticated()||this.router.navigate(["/login"])},4e3);return}this.cartService.addToCart({bookId:t._id,qty:1}).subscribe({next:e=>{this.snackBar.open("\u2705 Added to cart!","View",{duration:3e3,horizontalPosition:"center",verticalPosition:"top"}).onAction().subscribe(()=>{this.router.navigate(["/cart"])})},error:e=>{let r=e.error?.message||e.message||"Failed to add item to cart";this.snackBar.open("\u274C "+r,"Close",{duration:3e3,horizontalPosition:"center",verticalPosition:"top"})}})}static \u0275fac=function(e){return new(e||a)(i(c),i(h),i(g),i(p),i(u))};static \u0275prov=n({token:a,factory:a.\u0275fac,providedIn:"root"})};export{d as a};
