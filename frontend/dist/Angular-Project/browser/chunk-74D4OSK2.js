import{a as me}from"./chunk-WU3VHCCI.js";import{a as le}from"./chunk-OWXUTXTS.js";import{a as ae}from"./chunk-XYYWDBOZ.js";import{a as ne,b as de,c as ce}from"./chunk-RZHO2OWO.js";import{b as se}from"./chunk-OHDIIJHJ.js";import{a as R}from"./chunk-VRDYXINS.js";import{$a as B,Aa as c,Ab as z,C as V,Dc as J,Ec as Y,H as u,I as g,Ic as Q,Jc as X,Kc as Z,La as M,Lc as $,Ma as w,Mc as ee,Nc as te,Oa as a,Ob as K,Pa as P,Qa as v,Ta as _,Tc as ie,U as D,Ua as b,Uc as oe,V as d,Va as x,Ya as W,Yc as re,_a as q,aa as A,ab as N,cb as L,da as T,ea as O,ia as C,k as E,na as p,oa as o,pa as r,qa as k,qb as U,rb as j,sb as G,xa as S,xb as H,za as f}from"./chunk-DBZ4JVQV.js";var he=()=>[],fe=(s,i,e)=>({"bg-success":s,"bg-warning":i,"bg-danger":e}),_e=(s,i,e)=>({"text-success":s,"text-warning":i,"text-danger":e}),be=(s,i)=>({"bg-success":s,"bg-secondary":i});function xe(s,i){s&1&&(o(0,"div",7)(1,"div",8)(2,"span",9),a(3,"Loading..."),r()(),o(4,"p",10),a(5,"Loading author profile..."),r()())}function ke(s,i){if(s&1&&(o(0,"div",11)(1,"h4",12),a(2,"Error!"),r(),o(3,"p"),a(4),r(),k(5,"hr"),o(6,"p",13),a(7,"Please make sure you are logged in and have author privileges."),r()()),s&2){let e=c();d(4),P(e.error)}}function ve(s,i){if(s&1&&(o(0,"p",31),a(1),r()),s&2){let e=c(2);d(),P(e.author.bio)}}function Ce(s,i){if(s&1&&(o(0,"span",32),a(1),N(2,"date"),r()),s&2){let e=c(2);d(),v(" Applied: ",L(2,1,e.author.appliedAt,"short")," ")}}function ye(s,i){s&1&&(o(0,"div",7),k(1,"i",33),o(2,"p",34),a(3,"No books found. Create your first book!"),r()())}function Fe(s,i){if(s&1&&(o(0,"small",32),a(1),r()),s&2){let e=c().$implicit;d(),v(" ",e.description.substring(0,50),"... ")}}function Se(s,i){if(s&1){let e=S();o(0,"tr")(1,"td"),k(2,"img",38),r(),o(3,"td")(4,"strong"),a(5),r(),k(6,"br"),C(7,Fe,2,1,"small",23),r(),o(8,"td"),a(9),r(),o(10,"td")(11,"span",39),a(12),r()(),o(13,"td")(14,"span",22),a(15),r()(),o(16,"td")(17,"div",40)(18,"button",41),f("click",function(){let t=u(e).$implicit,n=c(3);return g(n.openEditBookForm(t))}),k(19,"i",42),a(20," Edit "),r(),o(21,"button",43),f("click",function(){let t=u(e).$implicit,n=c(3);return g(n.deleteBook(t))}),k(22,"i",44),a(23," Delete "),r()()()()}if(s&2){let e=i.$implicit;d(2),p("src",(e.image==null?null:e.image.url)||"https://via.placeholder.com/50x70?text=No+Image",D)("alt",e.title),d(3),P(e.title),d(2),p("ngIf",e.description),d(2),v("",e.price," EGP"),d(2),p("ngClass",B(9,_e,e.stock>10,e.stock>0&&e.stock<=10,e.stock===0)),d(),v(" ",e.stock," "),d(2),p("ngClass",q(13,be,e.isActive,!e.isActive)),d(),v(" ",e.isActive?"Active":"Inactive"," ")}}function we(s,i){if(s&1&&(o(0,"div",35)(1,"table",36)(2,"thead")(3,"tr")(4,"th"),a(5,"Image"),r(),o(6,"th"),a(7,"Title"),r(),o(8,"th"),a(9,"Price"),r(),o(10,"th"),a(11,"Stock"),r(),o(12,"th"),a(13,"Status"),r(),o(14,"th"),a(15,"Actions"),r()()(),o(16,"tbody"),C(17,Se,24,16,"tr",37),r()()()),s&2){let e=c(2);d(17),p("ngForOf",e.books)}}function Pe(s,i){if(s&1){let e=S();o(0,"li",47)(1,"a",48),f("click",function(){let t=u(e).$implicit,n=c(3);return g(n.onPageChange(t))}),a(2),r()()}if(s&2){let e=i.$implicit,l=c(3);w("active",e===l.currentPage),d(2),P(e)}}function Ae(s,i){if(s&1){let e=S();o(0,"nav",45)(1,"ul",46)(2,"li",47)(3,"a",48),f("click",function(){u(e);let t=c(2);return g(t.onPageChange(t.currentPage-1))}),a(4,"Previous"),r()(),C(5,Pe,3,3,"li",49),o(6,"li",47)(7,"a",48),f("click",function(){u(e);let t=c(2);return g(t.onPageChange(t.currentPage+1))}),a(8,"Next"),r()()()()}if(s&2){let e=c(2);d(2),w("disabled",e.currentPage===1),d(3),p("ngForOf",e.getPageNumbers()),d(),w("disabled",e.currentPage===e.totalPages)}}function Ee(s,i){if(s&1){let e=S();o(0,"div")(1,"div",14)(2,"div",15)(3,"div",16)(4,"div",17)(5,"div",18)(6,"div")(7,"h1",19),a(8),r(),C(9,ve,2,1,"p",20),o(10,"div",21)(11,"span",22),a(12),r(),C(13,Ce,3,4,"span",23),r()(),o(14,"button",24),f("click",function(){u(e);let t=c();return g(t.openCreateBookForm())}),k(15,"i",25),a(16," Create New Book "),r()()()()()(),o(17,"div",26)(18,"div",15)(19,"div",16)(20,"div",27)(21,"h3",13),a(22),r()(),o(23,"div",28),C(24,ye,4,0,"div",2)(25,we,18,1,"div",29)(26,Ae,9,5,"nav",30),r()()()()()}if(s&2){let e=c();d(8),P(e.author.name||"Author Profile"),d(),p("ngIf",e.author.bio),d(2),p("ngClass",B(9,fe,e.author.status==="approved",e.author.status==="pending",e.author.status==="rejected"||e.author.status==="revoked")),d(),v(" ",(e.author.status==null?null:e.author.status.toUpperCase())||"UNKNOWN"," "),d(),p("ngIf",e.author.appliedAt),d(9),v("My Books (",e.totalBooks,")"),d(2),p("ngIf",e.books.length===0),d(),p("ngIf",e.books.length>0),d(),p("ngIf",e.totalPages>1)}}function Me(s,i){if(s&1){let e=S();o(0,"div",50)(1,"div",51)(2,"div",52)(3,"div",53)(4,"h5",54),k(5,"i",25),a(6," Create New Book - Step 1: Required Information "),r(),o(7,"button",55),f("click",function(){u(e);let t=c();return g(t.closeBookForm())}),r()(),o(8,"div",56)(9,"div",57),k(10,"i",58),a(11," Please fill in the required fields to create the book. You can add more details in the next step. "),r(),o(12,"form")(13,"div",59)(14,"label",60),a(15,"Title "),o(16,"span",61),a(17,"*"),r()(),o(18,"input",62),x("ngModelChange",function(t){u(e);let n=c();return b(n.requiredForm.title,t)||(n.requiredForm.title=t),g(t)}),r()(),o(19,"div",26)(20,"div",63)(21,"label",64),a(22,"Price (EGP) "),o(23,"span",61),a(24,"*"),r()(),o(25,"input",65),x("ngModelChange",function(t){u(e);let n=c();return b(n.requiredForm.price,t)||(n.requiredForm.price=t),g(t)}),r()(),o(26,"div",63)(27,"label",66),a(28,"Stock "),o(29,"span",61),a(30,"*"),r()(),o(31,"input",67),x("ngModelChange",function(t){u(e);let n=c();return b(n.requiredForm.stock,t)||(n.requiredForm.stock=t),g(t)}),r()()(),o(32,"div",59)(33,"div",68),k(34,"i",69),a(35," Author: "),o(36,"strong"),a(37),r(),a(38," (pre-selected) "),r()()()(),o(39,"div",70)(40,"button",71),f("click",function(){u(e);let t=c();return g(t.closeBookForm())}),a(41,"Cancel"),r(),o(42,"button",72),f("click",function(){u(e);let t=c();return g(t.submitRequiredForm())}),k(43,"i",25),a(44," Create Book "),r()()()()()}if(s&2){let e=c();M("display",e.showBookForm&&!e.editingBook?"block":"none"),w("show",e.showBookForm&&!e.editingBook),d(18),_("ngModel",e.requiredForm.title),d(7),_("ngModel",e.requiredForm.price),d(6),_("ngModel",e.requiredForm.stock),d(6),P(e.author==null?null:e.author.name)}}function Ie(s,i){if(s&1&&(o(0,"small",32),a(1),r()),s&2){let e=c(2);d(),v("Selected: ",e.selectedImageFile.name)}}function Be(s,i){if(s&1&&(o(0,"small",32),a(1),r()),s&2){let e=c(2);d(),v("Selected: ",e.selectedPdfFile.name)}}function Ve(s,i){if(s&1){let e=S();o(0,"div",99)(1,"div",100)(2,"input",101),f("change",function(t){let n=u(e).$implicit,m=c(2);return g(m.onCategoryChange(t,n._id))}),r(),o(3,"label",102),a(4),r()()()}if(s&2){let e=i.$implicit,l=c(2);d(2),p("id","details-category-"+e._id)("checked",l.detailsForm.categories.includes(e._id)),d(),p("for","details-category-"+e._id),d(),v(" ",e.name," ")}}function De(s,i){if(s&1){let e=S();o(0,"div",50)(1,"div",51)(2,"div",52)(3,"div",73)(4,"h5",54),k(5,"i",42),a(6," Fill Book Details - Step 2: Optional Information "),r(),o(7,"button",55),f("click",function(){u(e);let t=c();return g(t.closeDetailsForm())}),r()(),o(8,"div",56)(9,"div",68),k(10,"i",74),a(11," Book created successfully! Now you can add optional details. "),r(),o(12,"form")(13,"div",59)(14,"label",75),a(15,"Description"),r(),o(16,"textarea",76),x("ngModelChange",function(t){u(e);let n=c();return b(n.detailsForm.description,t)||(n.detailsForm.description=t),g(t)}),r()(),o(17,"div",26)(18,"div",63)(19,"label",77),a(20,"ISBN"),r(),o(21,"input",78),x("ngModelChange",function(t){u(e);let n=c();return b(n.detailsForm.isbn,t)||(n.detailsForm.isbn=t),g(t)}),r()(),o(22,"div",63)(23,"label",79),a(24,"SKU"),r(),o(25,"input",80),x("ngModelChange",function(t){u(e);let n=c();return b(n.detailsForm.sku,t)||(n.detailsForm.sku=t),g(t)}),r()()(),o(26,"div",26)(27,"div",63)(28,"label",81),a(29,"Publisher"),r(),o(30,"input",82),x("ngModelChange",function(t){u(e);let n=c();return b(n.detailsForm.publisher,t)||(n.detailsForm.publisher=t),g(t)}),r()(),o(31,"div",63)(32,"label",83),a(33,"Language"),r(),o(34,"input",84),x("ngModelChange",function(t){u(e);let n=c();return b(n.detailsForm.language,t)||(n.detailsForm.language=t),g(t)}),r()()(),o(35,"div",59)(36,"label",85),a(37,"Published Date"),r(),o(38,"input",86),x("ngModelChange",function(t){u(e);let n=c();return b(n.detailsForm.publishedAt,t)||(n.detailsForm.publishedAt=t),g(t)}),r()(),o(39,"div",59)(40,"label",87),a(41,"Book Cover Image"),r(),o(42,"input",88),f("change",function(t){u(e);let n=c();return g(n.onImageFileSelected(t,!1))}),r(),o(43,"div",89),a(44,"Upload a cover image for the book (JPG, PNG, etc.)"),r(),C(45,Ie,2,1,"small",23),r(),o(46,"div",59)(47,"label",90),a(48,"Book PDF"),r(),o(49,"input",91),f("change",function(t){u(e);let n=c();return g(n.onPdfFileSelected(t,!1))}),r(),o(50,"div",89),a(51,"Upload the book PDF file"),r(),C(52,Be,2,1,"small",23),r(),o(53,"div",59)(54,"label",92),a(55,"Categories"),r(),o(56,"div",26),C(57,Ve,5,4,"div",93),r()(),o(58,"div",59)(59,"div",94)(60,"input",95),x("ngModelChange",function(t){u(e);let n=c();return b(n.detailsForm.isActive,t)||(n.detailsForm.isActive=t),g(t)}),r(),o(61,"label",96),a(62," Book is Active "),r()()()()(),o(63,"div",70)(64,"button",71),f("click",function(){u(e);let t=c();return g(t.closeDetailsForm())}),a(65,"Skip & Close"),r(),o(66,"button",97),f("click",function(){u(e);let t=c();return g(t.submitDetailsForm())}),k(67,"i",98),a(68," Update Details "),r()()()()()}if(s&2){let e=c();M("display",e.showDetailsForm?"block":"none"),w("show",e.showDetailsForm),d(16),_("ngModel",e.detailsForm.description),d(5),_("ngModel",e.detailsForm.isbn),d(4),_("ngModel",e.detailsForm.sku),d(5),_("ngModel",e.detailsForm.publisher),d(4),_("ngModel",e.detailsForm.language),d(4),_("ngModel",e.detailsForm.publishedAt),d(7),p("ngIf",e.selectedImageFile),d(7),p("ngIf",e.selectedPdfFile),d(5),p("ngForOf",e.categories),d(3),_("ngModel",e.detailsForm.isActive)}}function Te(s,i){if(s&1&&(o(0,"small",32),a(1),r()),s&2){let e=c(2);d(),v("Selected: ",e.selectedEditImageFile.name)}}function Oe(s,i){if(s&1&&(o(0,"small",32),a(1),r()),s&2){let e=c(2);d(),v("Current: ",e.bookForm.image.url)}}function We(s,i){if(s&1&&(o(0,"small",32),a(1),r()),s&2){let e=c(2);d(),v("Selected: ",e.selectedEditPdfFile.name)}}function qe(s,i){if(s&1&&(o(0,"small",32),a(1),r()),s&2){let e=c(2);d(),v("Current: ",e.bookForm.pdfUrl)}}function Ne(s,i){if(s&1){let e=S();o(0,"div",99)(1,"div",100)(2,"input",101),f("change",function(t){let n=u(e).$implicit,m=c(2);return g(m.onCategoryChange(t,n._id))}),r(),o(3,"label",102),a(4),r()()()}if(s&2){let e=i.$implicit,l=c(2);d(2),p("id","category-"+e._id)("checked",l.isCategorySelected(e._id)),d(),p("for","category-"+e._id),d(),v(" ",e.name," ")}}function Le(s,i){if(s&1){let e=S();o(0,"div",50)(1,"div",51)(2,"div",52)(3,"div",103)(4,"h5",54),a(5,"Edit Book"),r(),o(6,"button",104),f("click",function(){u(e);let t=c();return g(t.closeBookForm())}),r()(),o(7,"div",56)(8,"form",105),f("ngSubmit",function(){u(e);let t=c();return g(t.submitBookForm())}),o(9,"div",59)(10,"label",106),a(11,"Title "),o(12,"span",61),a(13,"*"),r()(),o(14,"input",107),x("ngModelChange",function(t){u(e);let n=c();return b(n.bookForm.title,t)||(n.bookForm.title=t),g(t)}),r()(),o(15,"div",59)(16,"label",108),a(17,"Description"),r(),o(18,"textarea",109),x("ngModelChange",function(t){u(e);let n=c();return b(n.bookForm.description,t)||(n.bookForm.description=t),g(t)}),r()(),o(19,"div",26)(20,"div",63)(21,"label",110),a(22,"Price (EGP) "),o(23,"span",61),a(24,"*"),r()(),o(25,"input",111),x("ngModelChange",function(t){u(e);let n=c();return b(n.bookForm.price,t)||(n.bookForm.price=t),g(t)}),r()(),o(26,"div",63)(27,"label",112),a(28,"Stock "),o(29,"span",61),a(30,"*"),r()(),o(31,"input",113),x("ngModelChange",function(t){u(e);let n=c();return b(n.bookForm.stock,t)||(n.bookForm.stock=t),g(t)}),r()()(),o(32,"div",26)(33,"div",63)(34,"label",114),a(35,"ISBN"),r(),o(36,"input",115),x("ngModelChange",function(t){u(e);let n=c();return b(n.bookForm.isbn,t)||(n.bookForm.isbn=t),g(t)}),r()(),o(37,"div",63)(38,"label",116),a(39,"SKU"),r(),o(40,"input",117),x("ngModelChange",function(t){u(e);let n=c();return b(n.bookForm.sku,t)||(n.bookForm.sku=t),g(t)}),r()()(),o(41,"div",26)(42,"div",63)(43,"label",118),a(44,"Publisher"),r(),o(45,"input",119),x("ngModelChange",function(t){u(e);let n=c();return b(n.bookForm.publisher,t)||(n.bookForm.publisher=t),g(t)}),r()(),o(46,"div",63)(47,"label",120),a(48,"Language"),r(),o(49,"input",121),x("ngModelChange",function(t){u(e);let n=c();return b(n.bookForm.language,t)||(n.bookForm.language=t),g(t)}),r()()(),o(50,"div",59)(51,"label",122),a(52,"Published Date"),r(),o(53,"input",123),x("ngModelChange",function(t){u(e);let n=c();return b(n.bookForm.publishedAt,t)||(n.bookForm.publishedAt=t),g(t)}),r()(),o(54,"div",59)(55,"label",124),a(56,"Book Cover Image"),r(),o(57,"input",125),f("change",function(t){u(e);let n=c();return g(n.onImageFileSelected(t,!0))}),r(),o(58,"div",89),a(59,"Upload a cover image for the book (JPG, PNG, etc.)"),r(),C(60,Te,2,1,"small",23)(61,Oe,2,1,"small",23),r(),o(62,"div",59)(63,"label",126),a(64,"Book PDF"),r(),o(65,"input",127),f("change",function(t){u(e);let n=c();return g(n.onPdfFileSelected(t,!0))}),r(),o(66,"div",89),a(67,"Upload the book PDF file"),r(),C(68,We,2,1,"small",23)(69,qe,2,1,"small",23),r(),o(70,"div",59)(71,"label",92),a(72,"Categories"),r(),o(73,"div",26),C(74,Ne,5,4,"div",93),r()(),o(75,"div",59)(76,"div",94)(77,"input",128),x("ngModelChange",function(t){u(e);let n=c();return b(n.bookForm.isActive,t)||(n.bookForm.isActive=t),g(t)}),r(),o(78,"label",129),a(79," Book is Active "),r()()(),o(80,"div",130)(81,"button",71),f("click",function(){u(e);let t=c();return g(t.closeBookForm())}),a(82,"Cancel"),r(),o(83,"button",131),a(84," Update Book "),r()()()()()()()}if(s&2){let e=c();M("display",e.showBookForm&&e.editingBook?"block":"none"),w("show",e.showBookForm&&e.editingBook),d(14),_("ngModel",e.bookForm.title),d(4),_("ngModel",e.bookForm.description),d(7),_("ngModel",e.bookForm.price),d(6),_("ngModel",e.bookForm.stock),d(5),_("ngModel",e.bookForm.isbn),d(4),_("ngModel",e.bookForm.sku),d(5),_("ngModel",e.bookForm.publisher),d(4),_("ngModel",e.bookForm.language),d(4),_("ngModel",e.bookForm.publishedAt),d(7),p("ngIf",e.selectedEditImageFile),d(),p("ngIf",!e.selectedEditImageFile&&(e.bookForm.image==null?null:e.bookForm.image.url)),d(7),p("ngIf",e.selectedEditPdfFile),d(),p("ngIf",!e.selectedEditPdfFile&&e.bookForm.pdfUrl),d(5),p("ngForOf",e.categories),d(3),_("ngModel",e.bookForm.isActive)}}var I=class s{constructor(i,e,l,t,n){this.authorService=i;this.bookService=e;this.categoryService=l;this.authService=t;this.uploadService=n}author=null;books=[];categories=[];loading=!0;error=null;showBookForm=!1;showDetailsForm=!1;editingBook=null;newlyCreatedBook=null;bookForm={title:"",description:"",price:0,stock:0,isbn:"",sku:"",publisher:"",language:"",publishedAt:new Date().toISOString().split("T")[0],authors:[],categories:[],isActive:!0,image:{url:""},pdfUrl:""};requiredForm={title:"",price:0,stock:0,authors:[]};detailsForm={description:"",pdfUrl:"",image:{url:""},isbn:"",sku:"",publisher:"",language:"",publishedAt:"",categories:[],isActive:!0};selectedImageFile=null;selectedPdfFile=null;selectedEditImageFile=null;selectedEditPdfFile=null;currentPage=1;pageSize=10;totalBooks=0;totalPages=0;ngOnInit(){this.loadAuthorProfile(),this.loadCategories()}loadAuthorProfile(){this.loading=!0,this.error=null,this.authorService.getMyAuthorProfile().subscribe({next:i=>{i&&(!i._id&&i.id&&(i._id=i.id),i._id&&!i.id&&(i.id=i._id)),this.author=i,console.log("Author profile loaded:",i),console.log("Author ID (_id):",i?._id),console.log("Author ID (id):",i?.id),this.loadMyBooks()},error:i=>{this.error=i.error?.message||"Failed to load author profile",this.loading=!1,console.error("Error loading author profile:",i)}})}loadMyBooks(){if(!this.author){this.loading=!1;return}let i=this.author._id||this.author.id;if(!i){this.loading=!1,this.error="Author ID not found";return}let e={page:this.currentPage,limit:this.pageSize,author:i};console.log("Loading books for author ID:",i),console.log("Author ID type:",typeof i),console.log("Author ID length:",i?.length),this.bookService.getAllBooks({page:1,limit:100}).subscribe({next:l=>{if(console.log("=== DEBUG: ALL BOOKS IN DATABASE ==="),console.log("Total books found:",l.items?.length||0),l.items&&l.items.length>0){console.log("Current author ID for comparison:",i),console.log("Current author ID type:",typeof i);let t=!1;l.items.forEach((n,m)=>{if(n.authors&&n.authors.length>0){let h=n.authors.map(y=>{if(typeof y=="object"){let ge=y._id||y.id||String(y);return String(ge)}return String(y)}),F=h.some(y=>String(y)===String(i));console.log(`
Book ${m+1}: "${n.title}"`),console.log(`  - Book ID: ${n._id||n.id}`),console.log("  - Author IDs in book:",h),console.log("  - Author IDs types:",h.map(y=>typeof y)),console.log(`  - Current author ID: ${i} (type: ${typeof i})`),console.log(`  - MATCHES? ${F?"\u2705 YES":"\u274C NO"}`),F&&(t=!0,console.log("  \u26A0\uFE0F This book SHOULD appear but doesn't! Backend filter issue."))}else console.log(`
Book ${m+1}: "${n.title}" - NO AUTHORS`)}),!t&&l.items.length>0&&(console.warn(`
\u26A0\uFE0F NO BOOKS FOUND WITH MATCHING AUTHOR ID!`),console.warn("This means books exist but were created with different author IDs."),console.warn("Possible causes:"),console.warn("1. Books were created before author ID normalization"),console.warn("2. Backend stored author IDs in different format"),console.warn("3. Author ID format mismatch (string vs ObjectId)"))}else console.log("No books found in database at all.");console.log(`=== END DEBUG ===
`)},error:l=>{console.error("Error fetching all books:",l)}}),this.bookService.getAllBooks(e).subscribe({next:l=>{console.log("Books response (with author filter):",l),this.books=l.items||[],this.totalBooks=l.meta?.total||0,this.totalPages=l.meta?.pages||0,this.books.length===0&&this.totalBooks===0?(console.warn("Backend filter returned 0 books. Applying frontend filter workaround..."),this.bookService.getAllBooks({page:1,limit:1e3}).subscribe({next:t=>{if(t.items&&t.items.length>0){let n=t.items.filter(m=>!m.authors||m.authors.length===0?!1:m.authors.map(F=>String(typeof F=="object"&&(F._id||F.id)||F)).some(F=>String(F)===String(i)));console.log(`Frontend filter found ${n.length} books for author`),this.books=n,this.totalBooks=n.length,this.totalPages=Math.ceil(n.length/this.pageSize),this.loading=!1,this.error=null}else this.loading=!1,this.error=null},error:t=>{console.error("Error in frontend filter workaround:",t),this.loading=!1,this.error=null}})):(this.loading=!1,this.error=null,console.log(`Loaded ${this.books.length} books for author`))},error:l=>{console.error("Error loading books:",l);let t=l.error?.error||l.error?.message||l.message||"Failed to load books";this.error=t,this.loading=!1,l.status===400&&(this.error="Invalid request. Please ensure you are logged in and have author privileges.")}})}loadCategories(){this.categoryService.getCategories().subscribe({next:i=>{this.categories=i},error:i=>{console.error("Error loading categories:",i)}})}openCreateBookForm(){if(!this.author){alert("Author profile not loaded. Please wait...");return}let i=this.author._id||this.author.id;if(!i){alert("Author ID not found. Please refresh the page.");return}console.log("Opening create book form with author ID:",i),console.log("Author object:",this.author),console.log("Using _id for book creation:",this.author._id),this.editingBook=null,this.newlyCreatedBook=null,this.requiredForm={title:"",price:0,stock:0,authors:[i]},console.log("Required form authors:",this.requiredForm.authors),this.detailsForm={description:"",pdfUrl:"",image:{url:""},isbn:"",sku:"",publisher:"",language:"",publishedAt:"",categories:[],isActive:!0},this.selectedImageFile=null,this.selectedPdfFile=null,this.showBookForm=!0,this.showDetailsForm=!1}openEditBookForm(i){this.editingBook=i,this.bookForm={title:i.title||"",description:i.description||"",price:i.price||0,stock:i.stock||0,isbn:i.isbn||"",sku:i.sku||"",publisher:i.publisher||"",language:i.language||"",publishedAt:i.publishedAt?new Date(i.publishedAt).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],authors:i.authors?.map(e=>e._id||e)||[this.author._id],categories:i.categories?.map(e=>e._id||e)||[],isActive:i.isActive!==void 0?i.isActive:!0,image:i.image||{url:""},pdfUrl:i.pdfUrl||""},this.selectedEditImageFile=null,this.selectedEditPdfFile=null,this.showBookForm=!0}closeBookForm(){this.showBookForm=!1,this.showDetailsForm=!1,this.editingBook=null,this.newlyCreatedBook=null,this.selectedImageFile=null,this.selectedPdfFile=null,this.selectedEditImageFile=null,this.selectedEditPdfFile=null}onImageFileSelected(i,e=!1){let l=i.target.files[0];l&&(e?this.selectedEditImageFile=l:this.selectedImageFile=l)}onPdfFileSelected(i,e=!1){let l=i.target.files[0];l&&(e?this.selectedEditPdfFile=l:this.selectedPdfFile=l)}closeDetailsForm(){this.showDetailsForm=!1,this.newlyCreatedBook=null,this.currentPage=1,this.loadMyBooks()}onCategoryChange(i,e){let l=i.target.checked;this.showDetailsForm?l?this.detailsForm.categories.includes(e)||this.detailsForm.categories.push(e):this.detailsForm.categories=this.detailsForm.categories.filter(t=>t!==e):l?this.bookForm.categories.includes(e)||this.bookForm.categories.push(e):this.bookForm.categories=this.bookForm.categories.filter(t=>t!==e)}isCategorySelected(i){return this.bookForm.categories.includes(i)}submitRequiredForm(){if(!this.requiredForm.title||!this.requiredForm.title.trim()){alert("Title is required");return}if(this.requiredForm.price<0){alert("Price must be 0 or greater");return}if(this.requiredForm.stock<0){alert("Stock must be 0 or greater");return}if(!this.requiredForm.authors||this.requiredForm.authors.length===0){alert("At least one author is required");return}let i=this.requiredForm.authors.filter(t=>t&&(typeof t=="string"||typeof t=="object"));if(i.length===0){alert("At least one valid author ID is required");return}let e=i.map(t=>typeof t=="object"&&(t._id||t.id)?t._id||t.id:String(t));console.log("Original author IDs from form:",this.requiredForm.authors),console.log("Validated author IDs for creation:",e);let l={title:this.requiredForm.title.trim(),price:parseFloat(String(this.requiredForm.price)),stock:parseInt(String(this.requiredForm.stock),10),authors:e};if(isNaN(l.price)||l.price<0){alert("Price must be a valid number greater than or equal to 0");return}if(isNaN(l.stock)||l.stock<0){alert("Stock must be a valid number greater than or equal to 0");return}console.log("Creating book with data:",l),console.log("Author IDs being sent (type):",typeof e[0]),console.log("Author IDs being sent (value):",e),console.log("Current author _id:",this.author._id),console.log("Current author id:",this.author.id),this.bookService.createBook(l).subscribe({next:t=>{if(console.log("Book creation response:",t),this.newlyCreatedBook=t.book||t,console.log("Newly created book:",this.newlyCreatedBook),this.newlyCreatedBook&&this.newlyCreatedBook.authors){console.log("Book authors in response:",this.newlyCreatedBook.authors);let n=this.newlyCreatedBook.authors.map(m=>typeof m=="object"&&(m._id||m.id)||String(m));console.log("Author IDs in created book response:",n),console.log("Expected author ID:",this.author._id||this.author.id),console.log("Author IDs match?",n.some(m=>String(m)===String(this.author._id||this.author.id)))}this.showBookForm=!1,this.showDetailsForm=!0,setTimeout(()=>{let n=this.newlyCreatedBook._id||this.newlyCreatedBook.id;n&&(console.log("Fetching created book directly by ID:",n),this.bookService.getBookById(n).subscribe({next:h=>{if(console.log("Fetched book directly:",h),h&&h.authors){console.log("Book authors (direct fetch):",h.authors);let F=h.authors.map(y=>typeof y=="object"?y._id||y.id:y);console.log("Book author IDs:",F),console.log("Current author ID:",this.author._id||this.author.id),console.log("Author IDs match:",F.includes(this.author._id||this.author.id))}},error:h=>{console.error("Error fetching created book:",h)}})),this.currentPage=1;let m=this.author._id||this.author.id;console.log("Refreshing books list with author ID:",m),console.log("Author ID type:",typeof m),this.loadMyBooks()},1e3),alert("Book created successfully! Now fill in the details.")},error:t=>{console.error("Error creating book:",t);let n="Failed to create book";if(t.error&&(t.error.message?n=t.error.message:t.error.error&&(n=t.error.error),t.error.details&&Array.isArray(t.error.details)&&t.error.details.length>0)){let m=t.error.details.map(h=>typeof h=="string"?h:h.message||JSON.stringify(h)).join(`
`);n+=`

Details:
`+m}alert(n)}})}submitDetailsForm(){if(!this.newlyCreatedBook){alert("Error: Book not found. Please try again."),this.closeDetailsForm();return}let i={};this.detailsForm.description&&(i.description=this.detailsForm.description.trim()),this.detailsForm.isbn&&(i.isbn=this.detailsForm.isbn.trim()),this.detailsForm.sku&&(i.sku=this.detailsForm.sku.trim()),this.detailsForm.publisher&&(i.publisher=this.detailsForm.publisher.trim()),this.detailsForm.language&&(i.language=this.detailsForm.language.trim()),this.detailsForm.publishedAt&&(i.publishedAt=new Date(this.detailsForm.publishedAt).toISOString()),this.detailsForm.categories&&this.detailsForm.categories.length>0&&(i.categories=this.detailsForm.categories),this.detailsForm.isActive!==void 0&&(i.isActive=this.detailsForm.isActive),this.selectedImageFile&&!i.image&&(i.image={});let e=this.newlyCreatedBook._id||this.newlyCreatedBook.id;this.bookService.updateBook(e,i).subscribe({next:l=>{let t=[];if(this.selectedImageFile){let n=E(this.uploadService.uploadImage(e,this.selectedImageFile)).then(()=>{console.log("Image uploaded successfully"),alert("Image uploaded successfully!")}).catch(m=>{console.error("Error uploading image:",m);let h=m.error?.error||m.error?.message||m.message||"Failed to upload image";alert(`Image upload failed: ${h}`)});t.push(n)}if(this.selectedPdfFile){let n=E(this.uploadService.uploadPdf(e,this.selectedPdfFile)).then(()=>{console.log("PDF uploaded successfully"),alert("PDF uploaded successfully!")}).catch(m=>{console.error("Error uploading PDF:",m);let h=m.error?.error||m.error?.message||m.message||"Failed to upload PDF";alert(`PDF upload failed: ${h}`)});t.push(n)}Promise.all(t).finally(()=>{alert("Book details updated successfully!"),this.closeDetailsForm(),this.loadMyBooks()})},error:l=>{alert(l.error?.message||"Failed to update book details"),console.error("Error updating book details:",l)}})}submitBookForm(){if(!this.bookForm.title||!this.bookForm.price||this.bookForm.stock===void 0){alert("Please fill in all required fields (Title, Price, Stock)");return}let i={title:this.bookForm.title.trim(),description:this.bookForm.description||"",price:parseFloat(this.bookForm.price),stock:parseInt(this.bookForm.stock),isActive:this.bookForm.isActive};this.bookForm.isbn&&(i.isbn=this.bookForm.isbn.trim()),this.bookForm.sku&&(i.sku=this.bookForm.sku.trim()),this.bookForm.publisher&&(i.publisher=this.bookForm.publisher.trim()),this.bookForm.language&&(i.language=this.bookForm.language.trim()),this.bookForm.publishedAt&&(i.publishedAt=new Date(this.bookForm.publishedAt).toISOString()),this.bookForm.authors&&this.bookForm.authors.length>0&&(i.authors=this.bookForm.authors),this.bookForm.categories&&this.bookForm.categories.length>0&&(i.categories=this.bookForm.categories),this.selectedEditImageFile&&!i.image&&(i.image={});let e=this.editingBook._id;this.bookService.updateBook(e,i).subscribe({next:l=>{let t=[];if(this.selectedEditImageFile){let n=E(this.uploadService.uploadImage(e,this.selectedEditImageFile)).then(()=>{console.log("Image uploaded successfully"),alert("Image uploaded successfully!")}).catch(m=>{console.error("Error uploading image:",m);let h=m.error?.error||m.error?.message||m.message||"Failed to upload image";alert(`Image upload failed: ${h}`)});t.push(n)}if(this.selectedEditPdfFile){let n=E(this.uploadService.uploadPdf(e,this.selectedEditPdfFile)).then(()=>{console.log("PDF uploaded successfully"),alert("PDF uploaded successfully!")}).catch(m=>{console.error("Error uploading PDF:",m);let h=m.error?.error||m.error?.message||m.message||"Failed to upload PDF";alert(`PDF upload failed: ${h}`)});t.push(n)}Promise.all(t).finally(()=>{alert("Book updated successfully!"),this.closeBookForm(),this.loadMyBooks()})},error:l=>{alert(l.error?.message||"Failed to update book"),console.error("Error updating book:",l)}})}deleteBook(i){confirm(`Are you sure you want to delete "${i.title}"? This action cannot be undone.`)&&this.bookService.deleteBook(i._id).subscribe({next:e=>{alert("Book deleted successfully!"),this.loadMyBooks()},error:e=>{alert(e.error?.message||"Failed to delete book"),console.error("Error deleting book:",e)}})}onPageChange(i){this.currentPage=i,this.loadMyBooks()}getPageNumbers(){let i=[];for(let e=1;e<=this.totalPages;e++)i.push(e);return i}static \u0275fac=function(e){return new(e||s)(A(se),A(ae),A(le),A(R),A(me))};static \u0275cmp=T({type:s,selectors:[["app-author-profile"]],standalone:!1,decls:10,vars:8,consts:[[1,"author-profile-container","py-5"],[1,"container"],["class","text-center py-5",4,"ngIf"],["class","alert alert-danger","role","alert",4,"ngIf"],[4,"ngIf"],["class","modal fade","tabindex","-1","style","background-color: rgba(0,0,0,0.5);",3,"show","display",4,"ngIf"],[3,"categories"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-danger"],[1,"visually-hidden"],[1,"mt-3"],["role","alert",1,"alert","alert-danger"],[1,"alert-heading"],[1,"mb-0"],[1,"row","mb-4"],[1,"col-12"],[1,"card","shadow-sm"],[1,"card-body","p-4"],[1,"d-flex","justify-content-between","align-items-start"],[1,"mb-2"],["class","text-muted mb-2",4,"ngIf"],[1,"d-flex","gap-3","mb-2"],[1,"badge",3,"ngClass"],["class","text-muted",4,"ngIf"],[1,"btn","btn-danger",3,"click"],[1,"bi","bi-plus-circle"],[1,"row"],[1,"card-header","bg-white"],[1,"card-body"],["class","table-responsive",4,"ngIf"],["aria-label","Books pagination","class","mt-4",4,"ngIf"],[1,"text-muted","mb-2"],[1,"text-muted"],[1,"bi","bi-book","fs-1","text-muted"],[1,"text-muted","mt-3"],[1,"table-responsive"],[1,"table","table-hover"],[4,"ngFor","ngForOf"],[1,"img-thumbnail",2,"width","50px","height","70px","object-fit","cover",3,"src","alt"],[3,"ngClass"],["role","group",1,"btn-group"],[1,"btn","btn-sm","btn-outline-primary",3,"click"],[1,"bi","bi-pencil"],[1,"btn","btn-sm","btn-outline-danger",3,"click"],[1,"bi","bi-trash"],["aria-label","Books pagination",1,"mt-4"],[1,"pagination","justify-content-center"],[1,"page-item"],[1,"page-link",2,"cursor","pointer",3,"click"],["class","page-item",3,"active",4,"ngFor","ngForOf"],["tabindex","-1",1,"modal","fade",2,"background-color","rgba(0,0,0,0.5)"],[1,"modal-dialog","modal-lg","modal-dialog-scrollable"],[1,"modal-content"],[1,"modal-header","bg-danger","text-white"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close","btn-close-white",3,"click"],[1,"modal-body"],[1,"alert","alert-info"],[1,"bi","bi-info-circle"],[1,"mb-3"],["for","requiredTitle",1,"form-label"],[1,"text-danger"],["type","text","id","requiredTitle","name","requiredTitle","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-md-6","mb-3"],["for","requiredPrice",1,"form-label"],["type","number","step","0.01","min","0","id","requiredPrice","name","requiredPrice","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","requiredStock",1,"form-label"],["type","number","min","0","id","requiredStock","name","requiredStock","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,"alert","alert-success"],[1,"bi","bi-person-check"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-danger",3,"click"],[1,"modal-header","bg-primary","text-white"],[1,"bi","bi-check-circle"],["for","detailsDescription",1,"form-label"],["id","detailsDescription","rows","4","name","detailsDescription",1,"form-control",3,"ngModelChange","ngModel"],["for","detailsIsbn",1,"form-label"],["type","text","id","detailsIsbn","name","detailsIsbn",1,"form-control",3,"ngModelChange","ngModel"],["for","detailsSku",1,"form-label"],["type","text","id","detailsSku","name","detailsSku",1,"form-control",3,"ngModelChange","ngModel"],["for","detailsPublisher",1,"form-label"],["type","text","id","detailsPublisher","name","detailsPublisher",1,"form-control",3,"ngModelChange","ngModel"],["for","detailsLanguage",1,"form-label"],["type","text","id","detailsLanguage","name","detailsLanguage",1,"form-control",3,"ngModelChange","ngModel"],["for","detailsPublishedAt",1,"form-label"],["type","date","id","detailsPublishedAt","name","detailsPublishedAt",1,"form-control",3,"ngModelChange","ngModel"],["for","detailsImageFile",1,"form-label"],["type","file","id","detailsImageFile","accept","image/*","name","detailsImageFile",1,"form-control",3,"change"],[1,"form-text"],["for","detailsPdfFile",1,"form-label"],["type","file","id","detailsPdfFile","accept",".pdf","name","detailsPdfFile",1,"form-control",3,"change"],[1,"form-label"],["class","col-md-4",4,"ngFor","ngForOf"],[1,"form-check","form-switch"],["type","checkbox","id","detailsIsActive","name","detailsIsActive",1,"form-check-input",3,"ngModelChange","ngModel"],["for","detailsIsActive",1,"form-check-label"],["type","button",1,"btn","btn-primary",3,"click"],[1,"bi","bi-check"],[1,"col-md-4"],[1,"form-check"],["type","checkbox",1,"form-check-input",3,"change","id","checked"],[1,"form-check-label",3,"for"],[1,"modal-header"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[3,"ngSubmit"],["for","title",1,"form-label"],["type","text","id","title","name","title","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","description",1,"form-label"],["id","description","rows","4","name","description",1,"form-control",3,"ngModelChange","ngModel"],["for","price",1,"form-label"],["type","number","id","price","name","price","min","0","step","0.01","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","stock",1,"form-label"],["type","number","id","stock","name","stock","min","0","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","isbn",1,"form-label"],["type","text","id","isbn","name","isbn",1,"form-control",3,"ngModelChange","ngModel"],["for","sku",1,"form-label"],["type","text","id","sku","name","sku",1,"form-control",3,"ngModelChange","ngModel"],["for","publisher",1,"form-label"],["type","text","id","publisher","name","publisher",1,"form-control",3,"ngModelChange","ngModel"],["for","language",1,"form-label"],["type","text","id","language","name","language",1,"form-control",3,"ngModelChange","ngModel"],["for","publishedAt",1,"form-label"],["type","date","id","publishedAt","name","publishedAt",1,"form-control",3,"ngModelChange","ngModel"],["for","imageFile",1,"form-label"],["type","file","id","imageFile","accept","image/*","name","imageFile",1,"form-control",3,"change"],["for","pdfFile",1,"form-label"],["type","file","id","pdfFile","accept",".pdf","name","pdfFile",1,"form-control",3,"change"],["type","checkbox","id","isActive","name","isActive",1,"form-check-input",3,"ngModelChange","ngModel"],["for","isActive",1,"form-check-label"],[1,"d-flex","justify-content-end","gap-2"],["type","submit",1,"btn","btn-danger"]],template:function(e,l){e&1&&(k(0,"app-header"),o(1,"div",0)(2,"div",1),C(3,xe,6,0,"div",2)(4,ke,8,1,"div",3)(5,Ee,27,13,"div",4),r()(),C(6,Me,45,8,"div",5)(7,De,69,14,"div",5)(8,Le,85,19,"div",5),k(9,"app-footer",6)),e&2&&(d(3),p("ngIf",l.loading),d(),p("ngIf",l.error&&!l.loading),d(),p("ngIf",!l.loading&&!l.error&&l.author),d(),p("ngIf",l.showBookForm&&!l.editingBook),d(),p("ngIf",l.showDetailsForm),d(),p("ngIf",l.showBookForm&&l.editingBook),d(),p("categories",W(7,he)))},dependencies:[U,j,G,ee,Y,te,J,Q,X,oe,ie,$,Z,de,ce,H],styles:[".author-profile-container[_ngcontent-%COMP%]{min-height:calc(100vh - 200px)}.modal[_ngcontent-%COMP%]{display:none}.modal.show[_ngcontent-%COMP%]{display:block}.modal.show[_ngcontent-%COMP%]   .modal-dialog[_ngcontent-%COMP%]{margin:1.75rem auto}.img-thumbnail[_ngcontent-%COMP%]{border:1px solid #dee2e6}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#f8f9fa;font-weight:600}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin-right:.25rem}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:last-child{margin-right:0}.card[_ngcontent-%COMP%]{border:none;border-radius:.5rem}.badge[_ngcontent-%COMP%]{font-size:.75rem;padding:.35em .65em}.pagination[_ngcontent-%COMP%]   .page-link[_ngcontent-%COMP%]{color:#dc3545;border-color:#dc3545}.pagination[_ngcontent-%COMP%]   .page-item.active[_ngcontent-%COMP%]   .page-link[_ngcontent-%COMP%]{background-color:#dc3545;border-color:#dc3545}.pagination[_ngcontent-%COMP%]   .page-link[_ngcontent-%COMP%]:hover{background-color:#dc3545;color:#fff}.form-label[_ngcontent-%COMP%]{font-weight:500;margin-bottom:.5rem}.form-control[_ngcontent-%COMP%]:focus{border-color:#dc3545;box-shadow:0 0 0 .2rem #dc354540}.btn-danger[_ngcontent-%COMP%]{background-color:#dc3545;border-color:#dc3545}.btn-danger[_ngcontent-%COMP%]:hover{background-color:#bb2d3b;border-color:#b02a37}.btn-outline-primary[_ngcontent-%COMP%]{color:#0d6efd;border-color:#0d6efd}.btn-outline-primary[_ngcontent-%COMP%]:hover{background-color:#0d6efd;border-color:#0d6efd;color:#fff}.btn-outline-danger[_ngcontent-%COMP%]{color:#dc3545;border-color:#dc3545}.btn-outline-danger[_ngcontent-%COMP%]:hover{background-color:#dc3545;border-color:#dc3545;color:#fff}.modal-content[_ngcontent-%COMP%]{border-radius:.5rem}.modal-header[_ngcontent-%COMP%]{border-bottom:1px solid #dee2e6;background-color:#f8f9fa}.modal-footer[_ngcontent-%COMP%]{border-top:1px solid #dee2e6}.spinner-border[_ngcontent-%COMP%]{width:3rem;height:3rem}"]})};var Ue=[{path:"",component:I}],ue=class s{static \u0275fac=function(e){return new(e||s)};static \u0275mod=O({type:s});static \u0275inj=V({imports:[z,K.forChild(Ue),re,ne]})};export{ue as AuthorProfileModule};
