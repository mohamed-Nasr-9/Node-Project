<app-header></app-header>
<div class="cart-container">


  <!-- Loading Spinner -->
  <div *ngIf="loading" class="loading-container">
    <mat-spinner></mat-spinner>
  </div>

  <!-- Empty Cart -->
  <div *ngIf="!loading && isEmpty" class="empty-cart">
    <mat-icon class="empty-icon">shopping_cart</mat-icon>
    <h2>Your cart is empty</h2>
    <p>Add some books to get started!</p>
    <button mat-raised-button color="primary" routerLink="/">
      Browse Books
    </button>
  </div>

  <!-- Cart with Items -->
  <div *ngIf="!loading && !isEmpty && cart" class="cart-content">
    <!-- Header -->
    <div class="cart-header">
      <h1>Shopping Cart ({{ itemCount }} items)</h1>
      <button mat-button color="warn" (click)="clearCart()">
        <mat-icon>delete_sweep</mat-icon>
        Clear Cart
      </button>
    </div>

    <!-- Cart Items -->
    <div class="cart-items">
      <mat-card *ngFor="let item of cartItems" class="cart-item-card">
        <div class="item-content">
          <!-- Book Image -->
          <div class="item-image">
            <img 
              [src]="getBook(item)?.image?.url || 'https://via.placeholder.com/150x200?text=Book'" 
              [alt]="getBook(item)?.title || 'Book'"
            >
          </div>

          <!-- Book Details -->
          <div class="item-details">
            <h3>{{ getBook(item)?.title || 'Unknown Book' }}</h3>
            <p class="author">by {{ getBook(item)?.author || 'Unknown Author' }}</p>
            <p class="price">{{ item.priceAtAdd }} EGP</p>
            
            <!-- Stock Status -->
            <div class="stock-status" [class.out-of-stock]="!item.isInStock">
              <mat-icon *ngIf="item.isInStock">check_circle</mat-icon>
              <mat-icon *ngIf="!item.isInStock">error</mat-icon>
              <span *ngIf="item.isInStock">
                In Stock 
                <span *ngIf="item.stockAvailable && item.stockAvailable <= 5">({{ item.stockAvailable }} available)</span>
              </span>
              <span *ngIf="!item.isInStock">Out of Stock</span>
            </div>
          </div>

          <!-- Quantity Controls -->
          <div class="item-quantity">
            <button 
              mat-icon-button 
              (click)="decreaseQty(item)"
              [disabled]="item.qty <= 1"
            >
              <mat-icon>remove</mat-icon>
            </button>
            
            <input 
              type="number" 
              [value]="item.qty" 
              (change)="updateQty(item, $event)"
              min="1"
              [max]="item.stockAvailable || 999"
            >
            
            <button 
              mat-icon-button 
              (click)="increaseQty(item)"
              [disabled]="item.qty >= (item.stockAvailable || 999)"
            >
              <mat-icon>add</mat-icon>
            </button>
          </div>

          <!-- Item Total -->
          <div class="item-total">
            <p class="total-label">Total</p>
            <p class="total-amount">{{ getItemTotal(item) }} EGP</p>
          </div>

          <!-- Remove Button -->
          <button 
            mat-icon-button 
            color="warn" 
            (click)="removeItem(item)"
            class="remove-btn"
          >
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </mat-card>
    </div>

    <!-- Cart Summary -->
    <mat-card class="cart-summary">
      <h2>Order Summary</h2>
      
      <div class="summary-row">
        <span>Subtotal ({{ itemCount }} items)</span>
        <span>{{ subtotal }} EGP</span>
      </div>
      
      <div class="summary-row">
        <span>Shipping</span>
        <span class="free">Applied on checkout</span>
      </div>
      
      <mat-divider></mat-divider>
      
      <div class="summary-row total">
        <span>Total</span>
        <span>{{ subtotal }} EGP</span>
      </div>

      <button mat-raised-button color="primary" class="checkout-btn" routerLink="payment"
      [disabled]="isEmpty">
        Proceed to Checkout
      </button>

      <button mat-stroked-button class="continue-btn" routerLink="/">
        Continue Shopping
      </button>

    </mat-card>
  </div>
</div>


<app-footer></app-footer>